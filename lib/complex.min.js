(function(){function e(e){return e>=0?e-e%1:e-(1+e%1)%1}function t(e){return e>=0?e+(1-e%1)%1:e-e%1}function n(t){return e(t+.5)}function r(e){return e-e%1}function i(e){return e%1}function C(e,t,n,r){var i=this instanceof C,s=i?this:new C(e,t,n,r);if(!i){return s}s.m=typeof n==="number"?o.abs(n):o.sqrt(e*e+t*t);if(typeof r==="number"){s.t=n>=0?r:r+a}else{s.t=o.atan2(t,e)}s.t=a-(a*3-(a-(a*3-s.t)%(a*2)))%(a*2);s.r=e;s.i=t}function k(e,t,n){if(w.test(e)){if(E.test(n.slice(t))){return e}return e.charAt(0).replace(p,k)+"*"+e.charAt(1).replace(p,k)}if(y.test(e)){return"("}if(b.test(e)){return")"}var r=e.search(S);return e.charAt(r!==-1?r:"*")}function L(e){var t=/[^a-z]+/i;e=e.map(function(e){var n=e.replace(t,"");if(!n){throw'"'+e+'" is an invalid variable name.'}return n.toLowerCase()});var n="abcdefghijklmnopqrstuvwxyz",r=n.length,i={},s="",o,u,a;for(o=0;o<e.length;o++){u=o;while(u>=0){a=u%r;u=u-a;s=n.charAt(a)+s;u=u/r-1}i[e[o]]=s;s=""}return i}function A(e,t){var n=1;while(e[t]==="("?n++:e[t]===")"?--n:t<e.length){t++}return t}function O(e,t){var n=0,r;for(r=t;r<e.length;r++){if(e[r]==="("){n++}else if(e[r]===")"){n--}if(n<0){return r}if(n===0){if(e[r]==="+"||e[r]==="-"&&!T[e[r-1]]){return r}}}return e.length}function M(e,t){var n=0,r;for(r=t;r<e.length;r++){if(e[r]==="("){n++}else if(e[r]===")"){n--}if(n<0){return r}if(n===0){if(e[r]==="+"||e[r]==="-"&&!T[e[r-1]]){return r}if(e[r]==="*"||e[r]==="/"||e[r]===" "||e[r]==="%"){return r}}}return e.length}function _(e,t,n){switch(e){case"+":case"-":return O(t,n);case"*":case" ":case"/":case"%":case"^":return M(t,n);default:throw'"'+e+'" is not a valid operator.'}}function D(){Array.apply(this,arguments)}function P(e,t,n){var r="",i=0,s=false,o,u,a,f,l,c,h;while(i<e.length){if(!s&&e.substr(i,2)!=="e^"&&e.substr(i).search(v)===0){o=e.substr(i).match(v)[0];u=N[o]||t[o];if(!u){throw'"'+o+'" is not a valid variable.'}r+=u;i+=o.length;s=true}else if(!s&&e.substr(i).search(d)===0){o=e.substr(i).match(d)[0];a=x[o];switch(o){case"-":h=O(e,i+o.length);break;case"e^":h=M(e,i+o.length);break;default:h=A(e,i+o.length);break}if(!a){o=o.substr(0,o.length-1);if(!(N[o]||t[o])){throw'"'+o+'(" is not a valid function.'}e=e.substr(0,i)+o+"*("+e.substr(i+o.length+1)}else{r+=a==="("?"":a;i+=o.length;r+=P(e.substring(i,h),t,n)+(a==="("?"":")");i=e[h]===")"?h+1:h;s=true}}else if(s&&e.substr(i).search(m)===0){o=e.substr(i).match(m)[0];f=T[o];c=e.substr(i+1).search(g)===0&&e.substr(i+1).match(g)[0];h=_(o,e,i+o.length+(c?c.length:0));if(!f){throw'"'+o+'" is not a valid operator.'}r+=f;i+=o.length;r+=P(e.substring(i,h),t,n)+")";i=e[h]===")"?h+1:h;s=true}else if(!s&&e.substr(i).search(g)===0){o=e.substr(i).match(g)[0];l=parseFloat(o);if(isNaN(l)){throw'"'+o+'" is not a valid number.'}r+="this["+n.push(new C(l,0,l,0))+"]";i+=o.length;s=true}else{throw'Unexpected character "'+e.charAt(i)+'".'}}return r}var s=this,o=s.Math,u=s.Number,a=o.PI,f=new C(o.sqrt(2*a),0,o.sqrt(2*a),0),l=7,c=[],h=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7].map(function(e,t){c.push(new C(t,0,t,0));return new C(e,0,o.abs(e),e<0?a:0)}),p=/(?:\d[a-z\{\[\(]|[\}\]\)][a-z\d])|(?:[\{\}\[\]]| *[\+\-\*\/\^ %] *)/gi,d=/[a-z]*\(|(?:-|e\^)(?:\(|)/,v=/[a-z]+(?![a-z]*\()/,m=/[\+\-\*\/\^ %]/,g=/(?:(?:\d*\.\d+|\d+\.\d*)|\d+)(?:e(?:[\-+]|)\d+(?!\d*\.)|)/,y=/\{|\[/,b=/\}|\]/,w=/\d[a-z\{\[\(]|[\}\]\)][a-z\d]/i,E=/(?:(?:\d*\.\d+|\d+\.\d*)|\d+)e(?:[\-+]|)\d+(?!\d*\.)/i,S=/[\+\-\*\/\^%]/,x={"(":"(","sqrt(":"C.sqrt(","cbrt(":"C.cbrt(","exp(":"C.exp(","e^(":"C.exp(","e^":"C.exp(","log(":"C.log(","ln(":"C.log(","gamma(":"C.gamma(","fact(":"C.fact(","factorial(":"C.fact(","sin(":"C.sin(","cos(":"C.cos(","tan(":"C.tan(","sec(":"C.sec(","csc(":"C.csc(","cot(":"C.cot(","arcsin(":"C.arcsin(","arccos(":"C.arccos(","arctan(":"C.arctan(","arcsec(":"C.arcsec(","arccsc(":"C.arccsc(","arccot(":"C.arccot(","arsin(":"C.arcsin(","arcos(":"C.arccos(","artan(":"C.arctan(","arsec(":"C.arcsec(","arcsc(":"C.arccsc(","arcot(":"C.arccot(","asin(":"C.arcsin(","acos(":"C.arccos(","atan(":"C.arctan(","asec(":"C.arcsec(","acsc(":"C.arccsc(","acot(":"C.arccot(","sinh(":"C.sinh(","cosh(":"C.cosh(","tanh(":"C.tanh(","sech(":"C.sech(","csch(":"C.csch(","coth(":"C.coth(","arcsinh(":"C.arcsinh(","arccosh(":"C.arccosh(","arctanh(":"C.arctanh(","arcsech(":"C.arcsech(","arccsch(":"C.arccsch(","arccoth(":"C.arccoth(","arsinh(":"C.arcsinh(","arcosh(":"C.arccosh(","artanh(":"C.arctanh(","arsech(":"C.arcsech(","arcsch(":"C.arccsch(","arcoth(":"C.arccoth(","asinh(":"C.arcsinh(","acosh(":"C.arccosh(","atanh(":"C.arctanh(","asech(":"C.arcsech(","acsch(":"C.arccsch(","acoth(":"C.arccoth(","-":"C.neg(","-(":"C.neg(","re(":"C.re(","real(":"C.re(","im(":"C.im(","imag(":"C.im(","abs(":"C.abs(","mag(":"C.abs(","arg(":"C.arg(","conj(":"C.conj(","norm(":"C.norm(","normal(":"C.norm(","floor(":"C.floor(","ceil(":"C.ceil(","ceiling(":"C.ceil(","round(":"C.round(","fpart(":"C.fPart(","frac(":"C.fPart(","ipart(":"C.iPart(","int(":"C.iPart("},T={"+":".add(","-":".sub(","*":".mult("," ":".mult(","/":".divBy(","%":".mod(","^":".cPow("},N={e:"C.E",i:"C.I",pi:"C.PI"};o.sinh=function(e){return(-o.exp(-e)+o.exp(e))/2};o.cosh=function(e){return(o.exp(-e)+o.exp(e))/2};u.EPSILON=u.EPSILON||2.220446049250313e-16;C.ZERO=new C(0,0,0,0);C.ONE=new C(1,0,1,0);C.I=new C(0,1,1,a/2);C.NEG_I=new C(0,-1,1,3*a/2);C.PI=new C(a,0,a,0);C.E=new C(o.E,0,o.E,0);C.TWO=new C(2,0,2,0);C.TWO_I=new C(0,2,2,a/2);C.Polar=function(e,t){return new C(e*o.cos(t),e*o.sin(t),e,t)};C.prototype.toString=function(e){if(!C.isFinite(this)){return"Infinity"}if(C.isNaN(this)){return"NaN"}if(e){var t=this.r.toPrecision().toUpperCase(),n=this.i.toPrecision().toUpperCase();if(this.i===0){return t}if(this.r===0){return o.abs(this.i)===1?this.i>0?"i":"-i":n+" i"}return t+(this.i>0?"+":"")+(o.abs(this.i)===1?this.i>0?"i":"-i":n+" i")}var r=this.m.toPrecision().toUpperCase(),i=this.t.toPrecision().toUpperCase();if(this.m===0||this.t===0){return r}return r+" e^("+i+" i)"};C.prototype.equals=function(e){var t=this.r,n=this.i,r=this.m,i=this.t,s=e.r,a=e.i,f=e.m,l=e.t,c=o.abs(t-s)<=o.max(o.abs(t),o.abs(s))*u.EPSILON,h=o.abs(n-a)<=o.max(o.abs(n),o.abs(a))*u.EPSILON,p=o.abs(r-f)<=o.max(o.abs(r),o.abs(f))*u.EPSILON,d=o.abs(i-l)<=o.max(o.abs(i),o.abs(l))*u.EPSILON;return c&&h||p&&d};C.prototype.re=C.prototype.real=function(){return this.r};C.prototype.im=C.prototype.imag=function(){return this.i};C.prototype.abs=C.prototype.mag=function(){return this.m};C.prototype.arg=C.prototype.angle=function(){return this.t};C.prototype.add=function(e){return new C(this.r+e.r,this.i+e.i)};C.prototype.sub=function(e){return new C(this.r-e.r,this.i-e.i)};C.prototype.mult=function(e){return C.Polar(this.m*e.m,this.t+e.t)};C.prototype.divBy=function(e){return C.Polar(this.m/e.m,this.t-e.t)};C.prototype.mod=function(e){return new C(e.r===0?0:this.r%e.r,e.i===0?0:this.i%e.i)};C.prototype.pow=function(e){if(e===2){return C.square(this)}if(e===3){return C.cube(this)}return C.Polar(o.pow(this.m,e),this.t*e)};C.prototype.cPow=function(e){if(e.i===0){return this.pow(e.r)}return C.Polar(o.pow(this.m,e.r)*o.exp(-e.i*this.t),e.i*o.log(this.m)+e.r*this.t)};C.neg=function(e){return new C(-e.r,-e.i,e.m,e.t+a)};C.re=function(e){return new C(e.r,0,o.abs(e.r),e.r<0?a:0)};C.im=function(e){return new C(e.i,0,o.abs(e.i),e.i<0?a:0)};C.abs=function(e){return new C(e.m,0,e.m,0)};C.arg=function(e){return new C(e.t,0,o.abs(e.t),e.t<0?a:0)};C.conj=function(e){return new C(e.r,-e.i,e.m,(a*2-e.t)%a*2)};C.norm=function(e){return C.Polar(e.m/e.m,e.m===0?0:e.t)};C.floor=function(t){return new C(e(t.r),e(t.i))};C.ceil=function(e){return new C(t(e.r),t(e.i))};C.round=function(e){return new C(n(e.r),n(e.i))};C.iPart=function(e){return new C(r(e.r),r(e.i))};C.fPart=function(e){return new C(i(e.r),i(e.i))};C.square=function(e){return new C(e.r*e.r-e.i*e.i,2*e.r*e.i,e.m*e.m,e.t*2)};C.cube=function(e){return new C(e.r*e.r*e.r-3*e.r*e.i*e.i,3*e.r*e.r*e.i-e.i*e.i*e.i,e.m*e.m*e.m,e.t*3)};C.sqrt=function(e){return e.pow(.5)};C.cbrt=function(e){return e.pow(1/3)};C.exp=function(e){return e.i===0?C.E.pow(e.r):C.Polar(o.exp(e.r),e.i)};C.log=function(e){return new C(o.log(e.m),e.t)};C.gamma=function(e){if(e.r<.5){return C.PI.divBy(C.sin(C.PI.mult(e)).mult(C.gamma(C.ONE.sub(e))))}var t=e.sub(C.ONE),n=h[0],r,i;for(r=1;r<l+2;r++){n=n.add(h[r].divBy(t.add(c[r])))}i=t.add(new C(l+.5,0,l+.5,0));return f.mult(i.cPow(t.add(new C(.5,0,.5,0)))).mult(C.exp(C.neg(i))).mult(n)};C.fact=function(e){return C.gamma(e.add(C.ONE))};C.cos=function(e){var t=e.mult(C.I);return C.exp(t).add(C.exp(C.neg(t))).divBy(C.TWO)};C.sin=function(e){var t=e.mult(C.I);return C.exp(t).sub(C.exp(C.neg(t))).divBy(C.TWO_I)};C.tan=function(e){var t=e.mult(C.I),n=C.exp(t),r=C.exp(C.neg(t));return n.sub(r).divBy(n.add(r).mult(C.I))};C.sec=function(e){var t=e.mult(C.I);return C.TWO.divBy(C.exp(t).add(C.exp(C.neg(t))))};C.csc=function(e){var t=e.mult(C.I);return C.TWO_I.divBy(C.exp(t).sub(C.exp(C.neg(t))))};C.cot=function(e){var t=e.mult(C.I),n=C.exp(t),r=C.exp(C.neg(t));return n.add(r).mult(C.I).divBy(n.sub(r))};C.arccos=function(e){return C.I.mult(C.log(e.add(C.NEG_I.mult(C.sqrt(C.ONE.sub(e.pow(2)))))))};C.arcsin=function(e){return C.NEG_I.mult(C.log(e.mult(C.I).add(C.sqrt(C.ONE.sub(e.pow(2))))))};C.arctan=function(e){var t=C.I;return t.mult(C.log(t.add(e).divBy(t.sub(e)))).divBy(C.TWO)};C.arcsec=function(e){return C.NEG_I.mult(C.log(e.pow(-1).add(C.sqrt(C.ONE.sub(C.I.divBy(e.pow(2)))))))};C.arccsc=function(e){return C.NEG_I.mult(C.log(C.I.divBy(e).add(C.sqrt(C.ONE.sub(e.pow(-2))))))};C.arccot=function(e){var t=C.I;return t.mult(C.log(e.sub(t).divBy(e.add(t)))).divBy(C.TWO)};C.cosh=function(e){return C.exp(e).add(C.exp(C.neg(e))).divBy(C.TWO)};C.sinh=function(e){return C.exp(e).sub(C.exp(C.neg(e))).divBy(C.TWO)};C.tanh=function(e){var t=C.exp(e),n=C.exp(C.neg(e));return t.sub(n).divBy(t.add(n))};C.sech=function(e){return C.TWO.divBy(C.exp(e).add(C.exp(C.neg(e))))};C.csch=function(e){return C.TWO.divBy(C.exp(e).sub(C.exp(C.neg(e))))};C.coth=function(e){var t=C.exp(e),n=C.exp(C.neg(e));return t.add(n).divBy(t.sub(n))};C.arccosh=function(e){return C.log(e.add(C.sqrt(e.pow(2).sub(C.ONE))))};C.arcsinh=function(e){return C.log(e.add(C.sqrt(e.pow(2).add(C.ONE))))};C.arctanh=function(e){return C.log(C.ONE.add(e).divBy(C.ONE.sub(e))).divBy(C.TWO)};C.arcsech=function(e){return C.log(C.ONE.add(C.sqrt(C.ONE.sub(e.pow(2)))).divBy(e))};C.arccsch=function(e){return C.log(C.ONE.add(C.sqrt(C.ONE.add(e.pow(2)))).divBy(e))};C.arccoth=function(e){return C.log(e.add(C.ONE).divBy(e.sub(C.ONE))).divBy(C.TWO)};C.min=function(){var e=[].slice.call(arguments).map(function(e){return e.m}),t=o.min.apply(o,e);return arguments[e.indexOf(t)]};C.max=function(){var e=[].slice.call(arguments).map(function(e){return e.m}),t=o.max.apply(o,e);return arguments[e.indexOf(t)]};C.isNaN=function(e){return isNaN(e.r)||isNaN(e.i)||isNaN(e.m)||isNaN(e.t)};C.isFinite=function(e){return isFinite(e.m)};C.formatFunction=function(e){return e.replace(p,k)};D.prototype=[];D.prototype.push=function(){return Array.prototype.push.apply(this,arguments)-1};D.prototype.Complex=C;C.parseFunction=function(e,t,n){e=e.toLowerCase();if(!n){e=C.formatFunction(e)}var r=L(t=t||[]),i=new D,s=P(e,r,i),o=t.map(function(e){return r[e]}).join(",");return(new Function(o,"var C=this.Complex;return "+s+";")).bind(i)};if(typeof module!=="undefined"&&module.exports){module.exports=C}else{s.Complex=C}})()