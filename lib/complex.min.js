(function(){function e(e){return e>=0?e-e%1:e-(1+e%1)%1}function t(e){return e>=0?e+(1-e%1)%1:e-e%1}function n(t){return e(t+.5)}function r(e){return e-e%1}function i(e){return e%1}function p(e,t,n,r){var i=this instanceof p,s=i?this:new p(e,t,n,r);if(!i){return s}s.m=typeof n==="number"?o.abs(n):o.sqrt(e*e+t*t);if(typeof r==="number"){s.t=n>=0?r:r+a}else{s.t=o.atan2(t,e)}s.t=a-(a*3-(a-(a*3-s.t)%(a*2)))%(a*2);s.r=e;s.i=t}var s=this,o=s.Math,u=s.Number,a=o.PI,f=new p(o.sqrt(2*a),0,o.sqrt(2*a),0),l=7,c=[],h=[.99999999999980993,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7].map(function(e,t){c.push(new p(t,0,t,0));return new p(e,0,o.abs(e),e<0?a:0)});o.sinh=function(e){return(-o.exp(-e)+o.exp(e))/2};o.cosh=function(e){return(o.exp(-e)+o.exp(e))/2};u.EPSILON=u.EPSILON||2.220446049250313e-16;p.Polar=function(e,t){return new p(e*o.cos(t),e*o.sin(t),e,t)};p.prototype.toString=function(e){if(!p.isFinite(this)){return"Infinity"}if(p.isNaN(this)){return"NaN"}if(e){var t=this.r.toPrecision().toUpperCase(),n=this.i.toPrecision().toUpperCase();if(this.i===0){return t}if(this.r===0){return o.abs(this.i)===1?this.i>0?"i":"-i":n+" i"}return t+(this.i>0?"+":"")+(o.abs(this.i)===1?this.i>0?"i":"-i":n+" i")}var r=this.m.toPrecision().toUpperCase(),i=this.t.toPrecision().toUpperCase();if(this.m===0||this.t===0){return r}return r+" e^("+i+" i)"};p.prototype.equals=function(e){var t=this.r,n=this.i,r=this.m,i=this.t,s=e.r,a=e.i,f=e.m,l=e.t;return o.abs(t-s)<=o.max(o.abs(t),o.abs(s))*u.EPSILON&&o.abs(n-a)<=o.max(o.abs(n),o.abs(a))*u.EPSILON||o.abs(r-f)<=o.max(o.abs(r),o.abs(f))*u.EPSILON&&o.abs(i-l)<=o.max(o.abs(i),o.abs(l))*u.EPSILON};p.prototype.re=p.prototype.real=function(){return this.r};p.prototype.im=p.prototype.imag=function(){return this.i};p.prototype.abs=p.prototype.mag=function(){return this.m};p.prototype.arg=p.prototype.angle=function(){return this.t};p.prototype.add=function(e){return new p(this.r+e.r,this.i+e.i)};p.prototype.sub=function(e){return new p(this.r-e.r,this.i-e.i)};p.prototype.mult=function(e){return p.Polar(this.m*e.m,this.t+e.t)};p.prototype.divBy=function(e){return p.Polar(this.m/e.m,this.t-e.t)};p.prototype.mod=function(e){return new p(e.r===0?0:this.r%e.r,e.i===0?0:this.i%e.i)};p.prototype.pow=function(e){if(e===2){return p.square(this)}if(e===3){return p.cube(this)}return p.Polar(o.pow(this.m,e),this.t*e)};p.prototype.cPow=function(e){return e.i===0?this.pow(e.r):p.Polar(o.pow(this.m,e.r)*o.exp(-e.i*this.t),e.i*o.log(this.m)+e.r*this.t)};p.neg=function(e){return new p(-e.r,-e.i,e.m,e.t+a)};p.re=function(e){return new p(e.r,0,o.abs(e.r),e.r<0?a:0)};p.im=function(e){return new p(e.i,0,o.abs(e.i),e.i<0?a:0)};p.abs=function(e){return new p(e.m,0,e.m,0)};p.arg=function(e){return new p(e.t,0,o.abs(e.t),e.t<0?a:0)};p.conj=function(e){return new p(e.r,-e.i,e.m,(a*2-e.t)%a*2)};p.norm=function(e){return p.Polar(e.m/e.m,e.m===0?0:e.t)};p.floor=function(t){return new p(e(t.r),e(t.i))};p.ceil=function(e){return new p(t(e.r),t(e.i))};p.round=function(e){return new p(n(e.r),n(e.i))};p.iPart=function(e){return new p(r(e.r),r(e.i))};p.fPart=function(e){return new p(i(e.r),i(e.i))};p.square=function(e){return new p(e.r*e.r-e.i*e.i,2*e.r*e.i,e.m*e.m,e.t*2)};p.cube=function(e){return new p(e.r*e.r*e.r-3*e.r*e.i*e.i,3*e.r*e.r*e.i-e.i*e.i*e.i,e.m*e.m*e.m,e.t*3)};p.sqrt=function(e){return e.pow(.5)};p.cbrt=function(e){return e.pow(1/3)};p.exp=function(e){return e.i===0?p.E.pow(e.r):p.Polar(o.exp(e.r),e.i)};p.log=function(e){return new p(o.log(e.m),e.t)};p.gamma=function(e){if(e.r<.5){return p.PI.divBy(p.sin(p.PI.mult(e)).mult(p.gamma(p["1"].sub(e))))}var t=e.sub(p["1"]),n=h[0],r,i;for(r=1;r<l+2;r++){n=n.add(h[r].divBy(t.add(c[r])))}i=t.add(new p(l+.5,0,l+.5,0));return f.mult(i.cPow(t.add(new p(.5,0,.5,0)))).mult(p.exp(p.neg(i))).mult(n)};p.fact=function(e){return p.gamma(e.add(p["1"]))};p.cos=function(e){var t=e.mult(p.I);return p.exp(t).add(p.exp(p.neg(t))).divBy(p["2"])};p.sin=function(e){var t=e.mult(p.I);return p.exp(t).sub(p.exp(p.neg(t))).divBy(p["2I"])};p.tan=function(e){var t=e.mult(p.I),n=p.exp(t),r=p.exp(p.neg(t));return n.sub(r).divBy(n.add(r).mult(p.I))};p.sec=function(e){var t=e.mult(p.I);return p["2"].divBy(p.exp(t).add(p.exp(p.neg(t))))};p.csc=function(e){var t=e.mult(p.I);return p["2I"].divBy(p.exp(t).sub(p.exp(p.neg(t))))};p.cot=function(e){var t=e.mult(p.I),n=p.exp(t),r=p.exp(p.neg(t));return n.add(r).mult(p.I).divBy(n.sub(r))};p.arccos=function(e){return p.I.mult(p.log(e.add(p["-I"].mult(p.sqrt(p["1"].sub(e.pow(2)))))))};p.arcsin=function(e){return p["-I"].mult(p.log(p.I.mult(e).add(p.sqrt(p["1"].sub(e.pow(2))))))};p.arctan=function(e){var t=p.I;return t.mult(p.log(t.add(e).divBy(t.sub(e)))).divBy(p["2"])};p.arcsec=function(e){return p["-I"].mult(p.log(e.pow(-1).add(p.sqrt(p["1"].sub(p.I.divBy(e.pow(2)))))))};p.arccsc=function(e){return p["-I"].mult(p.log(p.I.divBy(e).add(p.sqrt(p["1"].sub(e.pow(-2))))))};p.arccot=function(e){var t=p.I;return t.mult(p.log(e.sub(t).divBy(e.add(t)))).divBy(p["2"])};p.cosh=function(e){return p.exp(e).add(p.exp(p.neg(e))).divBy(p["2"])};p.sinh=function(e){return p.exp(e).sub(p.exp(p.neg(e))).divBy(p["2"])};p.tanh=function(e){var t=p.exp(e),n=p.exp(p.neg(e));return t.sub(n).divBy(t.add(n))};p.sech=function(e){return p["2"].divBy(p.exp(e).add(p.exp(p.neg(e))))};p.csch=function(e){return p["2"].divBy(p.exp(e).sub(p.exp(p.neg(e))))};p.coth=function(e){var t=p.exp(e),n=p.exp(p.neg(e));return t.add(n).divBy(t.sub(n))};p.arccosh=function(e){return p.log(e.add(p.sqrt(e.pow(2).sub(p["1"]))))};p.arcsinh=function(e){return p.log(e.add(p.sqrt(e.pow(2).add(p["1"]))))};p.arctanh=function(e){return p.log(p["1"].add(e).divBy(p["1"].sub(e))).divBy(p["2"])};p.arcsech=function(e){return p.log(p["1"].add(p.sqrt(p["1"].sub(e.pow(2)))).divBy(e))};p.arccsch=function(e){return p.log(p["1"].add(p.sqrt(p["1"].add(e.pow(2)))).divBy(e))};p.arccoth=function(e){return p.log(e.add(p["1"]).divBy(e.sub(p["1"]))).divBy(p["2"])};p.min=function(){var e=[].slice.call(arguments).map(function(e){return e.m}),t=o.min.apply(o,e);return arguments[e.indexOf(t)]};p.max=function(){var e=[].slice.call(arguments).map(function(e){return e.m}),t=o.max.apply(o,e);return arguments[e.indexOf(t)]};p.isNaN=function(e){return isNaN(e.r)||isNaN(e.i)||isNaN(e.m)||isNaN(e.t)};p.isFinite=function(e){return isFinite(e.m)};p.parseFunction=function(e,t,n){var r=this,i=r.generate(t=t||[]),s=new r.Namespace;e=e.toLowerCase();if(!n){e=r.formatFunction(e)}return(new Function(t.map(function(e){return i[e]}).join(","),"return "+function o(e){var t="",n=0,u=0,a,f,l,c,h,d,v;while(n<e.length){if(u!==2&&e.substr(n,2)!=="e^"&&e.substr(n).search(r.varsExp)===0){a=e.substr(n).match(r.varsExp)[0];f=r.varsObj[a]||i[a];if(!f){throw'"'+a+'" is not a valid variable.'}t+=f;n+=a.length;u=2}else if(u!==2&&e.substr(n).search(r.funcExp)===0){a=e.substr(n).match(r.funcExp)[0];l=r.funcObj[a];v=a==="-"?r.nextAddSub(e,n+a.length):a==="e^"?r.nextMultDiv(e,n+a.length):r.endNest(e,n+a.length);if(!l){a=a.substr(0,a.length-1);if(!(r.varsObj[a]||i[a])){throw'"'+a+'(" is not a valid function.'}e=e.substr(0,n)+a+"*("+e.substr(n+a.length+1)}else{t+=l==="("?"":l;n+=a.length;t+=o(e.substring(n,v))+(l==="("?"":")");n=e[v]===")"?v+1:v;u=2}}else if(u===2&&e.substr(n).search(r.operExp)===0){a=e.substr(n).match(r.operExp)[0];c=r.operObj[a];d=e.substr(n+1).search(r.numsExp)===0&&e.substr(n+1).match(r.numsExp)[0];v=r.nextOperator(a,e,n+a.length+(d?d.length:0));if(!c){throw'"'+a+'" is not a valid operator.'}t+=c;n+=a.length;t+=o(e.substring(n,v))+")";n=e[v]===")"?v+1:v;u=2}else if(u!==2&&e.substr(n).search(r.numsExp)===0){a=e.substr(n).match(r.numsExp)[0];h=parseFloat(a);if(isNaN(h)){throw'"'+a+'" is not a valid number.'}t+="this.array["+s.addComplex(new p(h,0,h,0))+"]";n+=a.length;u=2}else{throw'Unexpected character "'+e.charAt(n)+'".'}}return t}(e)+";")).bind(s)};p.parseFunction=p.parseFunction.bind(function(){var e=/(?:\d[a-z\{\[\(]|[\}\]\)][a-z\d])|(?:[\{\}\[\]]| *[\+\-\*\/\^ %] *)/gi,t=/[a-z]*\(|(?:-|e\^)(?:\(|)/,n=/[a-z]+(?![a-z]*\()/,r=/[\+\-\*\/\^ %]/,i=/(?:(?:\d*\.\d+|\d+\.\d*)|\d+)(?:e(?:[\-+]|)\d+(?!\d*\.)|)/,s={"(":"(","sqrt(":"this.Complex.sqrt(","cbrt(":"this.Complex.cbrt(","exp(":"this.Complex.exp(","e^(":"this.Complex.exp(","e^":"this.Complex.exp(","log(":"this.Complex.log(","ln(":"this.Complex.log(","gamma(":"this.Complex.gamma(","fact(":"this.Complex.fact(","factorial(":"this.Complex.fact(","sin(":"this.Complex.sin(","cos(":"this.Complex.cos(","tan(":"this.Complex.tan(","sec(":"this.Complex.sec(","csc(":"this.Complex.csc(","cot(":"this.Complex.cot(","arcsin(":"this.Complex.arcsin(","arccos(":"this.Complex.arccos(","arctan(":"this.Complex.arctan(","arcsec(":"this.Complex.arcsec(","arccsc(":"this.Complex.arccsc(","arccot(":"this.Complex.arccot(","arsin(":"this.Complex.arcsin(","arcos(":"this.Complex.arccos(","artan(":"this.Complex.arctan(","arsec(":"this.Complex.arcsec(","arcsc(":"this.Complex.arccsc(","arcot(":"this.Complex.arccot(","asin(":"this.Complex.arcsin(","acos(":"this.Complex.arccos(","atan(":"this.Complex.arctan(","asec(":"this.Complex.arcsec(","acsc(":"this.Complex.arccsc(","acot(":"this.Complex.arccot(","sinh(":"this.Complex.sinh(","cosh(":"this.Complex.cosh(","tanh(":"this.Complex.tanh(","sech(":"this.Complex.sech(","csch(":"this.Complex.csch(","coth(":"this.Complex.coth(","arcsinh(":"this.Complex.arcsinh(","arccosh(":"this.Complex.arccosh(","arctanh(":"this.Complex.arctanh(","arcsech(":"this.Complex.arcsech(","arccsch(":"this.Complex.arccsch(","arccoth(":"this.Complex.arccoth(","arsinh(":"this.Complex.arcsinh(","arcosh(":"this.Complex.arccosh(","artanh(":"this.Complex.arctanh(","arsech(":"this.Complex.arcsech(","arcsch(":"this.Complex.arccsch(","arcoth(":"this.Complex.arccoth(","asinh(":"this.Complex.arcsinh(","acosh(":"this.Complex.arccosh(","atanh(":"this.Complex.arctanh(","asech(":"this.Complex.arcsech(","acsch(":"this.Complex.arccsch(","acoth(":"this.Complex.arccoth(","-":"this.Complex.neg(","-(":"this.Complex.neg(","re(":"this.Complex.re(","real(":"this.Complex.re(","im(":"this.Complex.im(","imag(":"this.Complex.im(","abs(":"this.Complex.abs(","mag(":"this.Complex.abs(","arg(":"this.Complex.arg(","conj(":"this.Complex.conj(","norm(":"this.Complex.norm(","normal(":"this.Complex.norm(","floor(":"this.Complex.floor(","ceil(":"this.Complex.ceil(","ceiling(":"this.Complex.ceil(","round(":"this.Complex.round(","fpart(":"this.Complex.fPart(","frac(":"this.Complex.fPart(","ipart(":"this.Complex.iPart(","int(":"this.Complex.iPart("},o={"+":".add(","-":".sub(","*":".mult("," ":".mult(","/":".divBy(","%":".mod(","^":".cPow("},u={e:"this.Complex.E",i:"this.Complex.I",pi:"this.Complex.PI"},a=function(t){var n=/\{|\[/,r=/\}|\]/,i=/\d[a-z\{\[\(]|[\}\]\)][a-z\d]/i,s=/^\de(?:[\-+]|)\d+(?!\d*\.)/i,o=/[\+\-\*\/\^%]/;return t.replace(e,function u(a,f){if(i.test(a)){if(s.test(t.slice(f))){return a}return a.charAt(0).replace(e,u)+"*"+a.charAt(1).replace(e,u)}if(n.test(a)){return"("}if(r.test(a)){return")"}var l=a.search(o);return a.charAt(l!==-1?l:"*")})},f=function(e){var t=/[^a-z]+/i;e=e.map(function(e){var n=e.replace(t,"");if(!n){throw'"'+e+'" is an invalid variable name. Only "a" through "z" are accepted within names. "e", "i" and "pi", will be calculated as the constants.'}return n.toLowerCase()});var n="abcdefghijklmnopqrstuvwxyz",r=n.length,i={},s="",o,u,a;for(o=0;o<e.length;o++){u=o;while(u>=0){a=u%r;u=u-a;s=n.charAt(a)+s;u=u/r-1}i[e[o]]=s;s=""}return i},l=function(e,t){var n=1;while(e[t]==="("?n++:e[t]===")"?--n:t<e.length){t++}return t},c=function(e,t){var n=0,r;for(r=t;r<e.length;r++){if(e[r]==="("){n++}else if(e[r]===")"){n--}if(n<0){return r}if(n===0){if(e[r]==="+"||e[r]==="-"&&!o[e[r-1]]){return r}}}return e.length},h=function(e,t){var n=0,r;for(r=t;r<e.length;r++){if(e[r]==="("){n++}else if(e[r]===")"){n--}if(n<0){return r}if(n===0){if(e[r]==="+"||e[r]==="-"&&!o[e[r-1]]){return r}if(e[r]==="*"||e[r]==="/"||e[r]===" "||e[r]==="%"){return r}}}return e.length},d=function(e,t,n){switch(e){case"+":case"-":return c(t,n);case"*":case" ":case"/":case"%":case"^":return h(t,n);default:throw'"'+e+'" is not a valid operator.'}},v=function(){var e=this;e.array=[];e.Complex=p;e.addComplex=function(t){e.array.push(t);return e.array.length-1}};p.formatFunction=a;return{funcExp:t,varsExp:n,operExp:r,numsExp:i,funcObj:s,varsObj:u,operObj:o,generate:f,formatFunction:a,endNest:l,nextAddSub:c,nextMultDiv:h,nextOperator:d,Namespace:v}}());p["0"]=new p(0,0,0,0);p["1"]=new p(1,0,1,0);p.I=new p(0,1,1,a/2);p["-I"]=new p(0,-1,1,3*a/2);p.PI=new p(a,0,a,0);p.E=new p(o.E,0,o.E,0);p["2"]=new p(2,0,2,0);p["2I"]=new p(0,2,2,a/2);if(typeof module!=="undefined"&&module.exports){module.exports=p}else{s.Complex=p}})()